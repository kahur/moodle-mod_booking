{"version":3,"file":"view_actions.min.js","sources":["../src/view_actions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for booking module\n *\n * @module mod_booking/view_actions\n * @package mod_booking\n * @copyright 2017 David Bogner <info@edulabs.org>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since 3.1\n */\n\ndefine(['jquery', 'core/config', 'mod_booking/jquery.barrating', 'jqueryui'],\n        function($, mdlconfig) {\n            return {\n                setup : function(id) {\n                    $('.starrating').each(function(index, value) {\n                        var currentrating = $(this).data('current-rating');\n                        var itemid = $(this).data('itemid');\n                        if(!value) {\n                            // Just for stupid TravisCI rules!\n                            value = '';\n                        }\n                        var thisid = this;\n                        $(this).barrating({\n                            initialRating: currentrating,\n                            theme: 'css-stars',\n                            onSelect: function(value, text, event) {\n                                if (typeof(event) !== 'undefined') {\n                                    $.ajax({\n                                        url: mdlconfig.wwwroot + \"/mod/booking/rating_rest.php?id=\" + id,\n                                        method: \"POST\",\n                                        data: { optionid: itemid, value: value }\n                                    }).done(function(data) {\n                                        $(thisid).barrating('readonly', true);\n                                        $(thisid).barrating('set', data.rate);\n                                    });\n                                }\n                            }\n                        });\n                    });\n                    $('#showHideSearch').on('click', function() {\n                        $('#tableSearch').fadeToggle(\"slow\", \"linear\");\n                        $('html, body').animate({\n                            scrollTop : $(\"#tableSearch\").offset().top - 120\n                        }, 1000);\n                    });\n                    $('.showHideOptionText').on('click', function() {\n                        $('#optiontext' + $(this).data(\"id\")).fadeToggle(\"slow\", \"linear\");\n                        $('#showtext' + $(this).data(\"id\")).toggle();\n                        $('#hidetext' + $(this).data(\"id\")).toggle();\n                        $('html, body').animate({\n                            scrollTop : $('#optiontext' + $(this).data(\"id\")).offset().top - 120\n                        }, 1000);\n                    });\n                    $('#page-mod-booking-view #buttonclear')\n                            .on('click',\n                                    function() {\n                                        $('#searchtext, #searchlocation, #searchinstitution, #searchname, #searchsurname')\n                                                .val('');\n                                        $('#searchButton').trigger('click');\n                                    });\n                    $('#page-mod-booking-report #buttonclear')\n                            .on('click',\n                                    function() {\n                                        $('#menusearchwaitinglist, #menusearchfinished, #searchdate')\n                                                .val('');\n                                        $('#searchButton').trigger('click');\n                                    });\n                    $('#page-mod-booking-report #usercheckboxall')\n                            .click(function() {\n                                $('#studentsform input:checkbox').not(this)\n                                        .prop('checked', this.checked);\n                            });\n                    $('#page-mod-booking-report #menuratingall')\n                            .change(function() {\n                                $('#studentsform input:checkbox').not(this)\n                                        .prop('checked', 'checked');\n                                var selected = $(this).val();\n                                $('.booking-option-rating .postratingmenu.ratinginput [value=\"' + selected + '\"]')\n                                        .attr('selected', true);\n                            });\n                    $('#page-mod-booking-report .booking-option-rating .ratinginput')\n                            .change(function() {\n                                var selectid = $(this).attr('id');\n                                var selected = selectid.replace(/\\D/g, '');\n                                $('#studentsform [id=check' + selected + ']')\n                                        .prop('checked', 'checked');\n                            });\n                    $(\"#sortable\").sortable().on('sortupdate', function() {\n\n                        // In this function we append the link with the right sorting order of the items.\n                        var list = $(\"li\").map(function() {\n                            return $(this).data(\"id\");\n                        }).get();\n                        var link = $('#confirmbutton').attr('href');\n                        link = link.split('&list=');\n                        link = link[0] + '&list=' + JSON.stringify(list);\n                        $('#confirmbutton').attr('href', link);\n                    });\n                }\n            };\n        });"],"names":["define","$","mdlconfig","setup","id","each","index","value","currentrating","this","data","itemid","thisid","barrating","initialRating","theme","onSelect","text","event","ajax","url","wwwroot","method","optionid","done","rate","on","fadeToggle","animate","scrollTop","offset","top","toggle","val","trigger","click","not","prop","checked","change","selected","attr","replace","sortable","list","map","get","link","split","JSON","stringify"],"mappings":";;;;;;;;;AAyBAA,kCAAO,CAAC,SAAU,cAAe,+BAAgC,aACzD,SAASC,EAAGC,iBACD,CACHC,MAAQ,SAASC,IACbH,EAAE,eAAeI,MAAK,SAASC,MAAOC,WAC9BC,cAAgBP,EAAEQ,MAAMC,KAAK,kBAC7BC,OAASV,EAAEQ,MAAMC,KAAK,UACtBH,QAEAA,MAAQ,QAERK,OAASH,KACbR,EAAEQ,MAAMI,UAAU,CACdC,cAAeN,cACfO,MAAO,YACPC,SAAU,SAAST,MAAOU,KAAMC,YACN,IAAXA,OACPjB,EAAEkB,KAAK,CACHC,IAAKlB,UAAUmB,QAAU,mCAAqCjB,GAC9DkB,OAAQ,OACRZ,KAAM,CAAEa,SAAUZ,OAAQJ,MAAOA,SAClCiB,MAAK,SAASd,MACbT,EAAEW,QAAQC,UAAU,YAAY,GAChCZ,EAAEW,QAAQC,UAAU,MAAOH,KAAKe,eAMpDxB,EAAE,mBAAmByB,GAAG,SAAS,WAC7BzB,EAAE,gBAAgB0B,WAAW,OAAQ,UACrC1B,EAAE,cAAc2B,QAAQ,CACpBC,UAAY5B,EAAE,gBAAgB6B,SAASC,IAAM,KAC9C,QAEP9B,EAAE,uBAAuByB,GAAG,SAAS,WACjCzB,EAAE,cAAgBA,EAAEQ,MAAMC,KAAK,OAAOiB,WAAW,OAAQ,UACzD1B,EAAE,YAAcA,EAAEQ,MAAMC,KAAK,OAAOsB,SACpC/B,EAAE,YAAcA,EAAEQ,MAAMC,KAAK,OAAOsB,SACpC/B,EAAE,cAAc2B,QAAQ,CACpBC,UAAY5B,EAAE,cAAgBA,EAAEQ,MAAMC,KAAK,OAAOoB,SAASC,IAAM,KAClE,QAEP9B,EAAE,uCACOyB,GAAG,SACI,WACIzB,EAAE,iFACOgC,IAAI,IACbhC,EAAE,iBAAiBiC,QAAQ,YAE/CjC,EAAE,yCACOyB,GAAG,SACI,WACIzB,EAAE,4DACOgC,IAAI,IACbhC,EAAE,iBAAiBiC,QAAQ,YAE/CjC,EAAE,6CACOkC,OAAM,WACHlC,EAAE,gCAAgCmC,IAAI3B,MAC7B4B,KAAK,UAAW5B,KAAK6B,YAE1CrC,EAAE,2CACOsC,QAAO,WACJtC,EAAE,gCAAgCmC,IAAI3B,MAC7B4B,KAAK,UAAW,eACrBG,SAAWvC,EAAEQ,MAAMwB,MACvBhC,EAAE,8DAAgEuC,SAAW,MACpEC,KAAK,YAAY,MAEtCxC,EAAE,gEACOsC,QAAO,eAEAC,SADWvC,EAAEQ,MAAMgC,KAAK,MACJC,QAAQ,MAAO,IACvCzC,EAAE,0BAA4BuC,SAAW,KAChCH,KAAK,UAAW,cAErCpC,EAAE,aAAa0C,WAAWjB,GAAG,cAAc,eAGnCkB,KAAO3C,EAAE,MAAM4C,KAAI,kBACZ5C,EAAEQ,MAAMC,KAAK,SACrBoC,MACCC,KAAO9C,EAAE,kBAAkBwC,KAAK,QAEpCM,MADAA,KAAOA,KAAKC,MAAM,WACN,GAAK,SAAWC,KAAKC,UAAUN,MAC3C3C,EAAE,kBAAkBwC,KAAK,OAAQM"}